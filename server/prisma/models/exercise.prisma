// Exercise and program models
/// @namespace "Exercise"

model Exercise {
  id              String    @id @default(cuid())
  title           String
  description     String?   @db.Text
  imageUrl        String?   @map("image_url")
  durationMinutes Int?      @map("duration_minutes")
  intensity       Intensity?
  muscleZone      MuscleZone? @map("muscle_zone")
  createdBy       String?   @map("created_by") // null = system exercise, value = user ID
  
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  creator          User?             @relation("UserCreatedExercises", fields: [createdBy], references: [id], onDelete: SetNull)
  exerciseTags     ExerciseTag[]
  phaseExercises   PhaseExercise[]
  programExercises ProgramExercise[]
  favoriteExercises FavoriteExercise[]
  ratings          ExerciseRating[]

  @@index([createdBy])
  @@map("exercise")
}

model Tag {
  id           String       @id @default(cuid())
  name         String       @unique
  type         TagType
  
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")

  // Relations
  exerciseTags ExerciseTag[]

  @@map("tag")
}

model ExerciseTag {
  id         String   @id @default(cuid())
  exerciseId String   @map("exercise_id")
  tagId      String   @map("tag_id")
  
  createdAt  DateTime @default(now()) @map("created_at")

  // Relations
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([exerciseId, tagId])
  @@map("exercise_tag")
}

model PhaseExercise {
  id         String     @id @default(cuid())
  phaseName  CyclePhase @map("phase_name")
  exerciseId String     @map("exercise_id")
  
  createdAt  DateTime   @default(now()) @map("created_at")

  // Relations
  exercise   Exercise   @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

  @@index([phaseName])
  @@map("phase_exercise")
}

model Program {
  id        String    @id @default(cuid())
  userId    String    @map("user_id")
  title     String
  goal      String?
  startDate DateTime  @map("start_date")
  endDate   DateTime? @map("end_date")
  isActive  Boolean   @default(false) @map("is_active")
  isTemplate Boolean  @default(false) @map("is_template")
  
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  // Relations
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  programExercises ProgramExercise[]
  notifications    Notification[]

  @@index([userId])
  @@index([isActive])
  @@index([isTemplate])
  @@map("program")
}

model ProgramExercise {
  id         String   @id @default(cuid())
  programId  String   @map("program_id")
  exerciseId String   @map("exercise_id")
  order      Int
  sets       Int?
  reps       String?  // Can be a range like "8-12" or single number like "10"
  duration   Int?     // Duration in seconds for time-based exercises
  restTime   Int?     @map("rest_time") // Rest time in seconds between sets
  notes      String?  @db.Text
  
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  // Relations
  program    Program  @relation(fields: [programId], references: [id], onDelete: Cascade)
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

  @@index([programId])
  @@index([order])
  @@map("program_exercise")
}

model FavoriteExercise {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  exerciseId String   @map("exercise_id")
  
  createdAt  DateTime @default(now()) @map("created_at")

  // Relations
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

  @@unique([userId, exerciseId])
  @@index([userId])
  @@map("favorite_exercise")
}

model ExerciseRating {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  exerciseId String   @map("exercise_id")
  rating     Int      // 1-5 stars
  comment    String?  @db.Text
  
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  // Relations
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

  @@unique([userId, exerciseId])
  @@index([userId])
  @@index([exerciseId])
  @@map("exercise_rating")
} 